import pandas as pdimport scipy.spatialimport numpy as npfrom geopy.distance import vincentydf1 = pd.read_json("places_bar.json")df2 = pd.read_json("places_cafe.json")df3 = pd.read_json("places_restaurant.json")# df4 = pd.read_json("places_bakery.json")df = pd.concat([df1, df2, df3], sort = True)a = df.loc[df['id'] == '1fd0b456f23102dad2dc238b8c6d0a9c1ac85585']df = df.drop_duplicates(['id'], keep='last')df = df.reset_index(drop=True)b = df.loc[df['id'] == '1fd0b456f23102dad2dc238b8c6d0a9c1ac85585']print(b)df['location'] = pd.DataFrame(df.geometry.tolist()).locationd = df.loc[df['id'] == '1fd0b456f23102dad2dc238b8c6d0a9c1ac85585']# df.drop(df.columns[[3,4,7,9,10,13,14,15, 16]], axis=1)e = df.loc[df['id'] == '1fd0b456f23102dad2dc238b8c6d0a9c1ac85585']df = df.join(pd.DataFrame(df.location.tolist()))f = df.loc[df['id'] == '1fd0b456f23102dad2dc238b8c6d0a9c1ac85585']df = df.drop('location', 1)c = df.loc[df['id'] == '1fd0b456f23102dad2dc238b8c6d0a9c1ac85585']# print('кол-во NA\n', df.isna().sum())# print(len(df))metro = pd.read_excel("metro_station-2.xls", )mat = scipy.spatial.distance.cdist(df[["lat", "lng"]], metro[["Широта", "Долгота"]], lambda u, v: vincenty(u, v).kilometers)new_df = pd.DataFrame(mat, index=df["id"], columns=metro["Вестибюль станции"])closest = np.where(new_df.eq(new_df.min(axis=1), 0), new_df.columns, False)closest_km = new_df.min(axis=1)df["closest_metro"] = [i[i.astype(bool)].tolist() for i in closest]df["closest_metro_km"] = closest_km.tolist()d = df.loc[df['id'] == '1fd0b456f23102dad2dc238b8c6d0a9c1ac85585']df.to_csv('data_food.csv', index=False, encoding='utf-8')print(len(df))